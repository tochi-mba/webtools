window.onload=()=>{let e={remove_when_ended:!0,show_seek_bar:!0,autoplay:!0,quick_switch_links:"https://www.youtube.com/",skip_seconds:2};function t(e,t){let s=document.createElement("div");s.style.position="absolute",s.innerHTML="⏸",s.style.backgroundColor="black",s.style.top="30px",s.style.left="30px",s.style.zIndex="10000",s.style.fontSize="20px",s.style.color="white",s.style.cursor="pointer",s.style.display="none",s.addEventListener("click",()=>{t.paused?(t.play(),s.innerHTML="⏸",(vid=JSON.parse(sessionStorage.getItem("vid"))).forEach(e=>{e.src===t.src&&(e.paused=!1)}),sessionStorage.setItem("vid",JSON.stringify(vid))):(t.pause(),s.innerHTML="▶",(vid=JSON.parse(sessionStorage.getItem("vid"))).forEach(e=>{e.src===t.src&&(e.paused=!0)}),sessionStorage.setItem("vid",JSON.stringify(vid)))}),e.appendChild(s);let r=document.createElement("button");if(r.textContent="\xd7",r.style.backgroundColor="black",r.style.display="none",r.style.color="white",r.style.fontSize="20px",r.style.position="absolute",r.style.top="5px",r.style.right="5px",r.style.zIndex="10000",r.style.cursor="pointer",r.addEventListener("click",()=>{document.body.removeChild(e),vid=JSON.parse(sessionStorage.getItem("vid"));let s=vid.findIndex(e=>e.src===t.src);vid.splice(s,1),sessionStorage.setItem("vid",JSON.stringify(vid))}),e.appendChild(r),sessionStorage.getItem("configGoon")&&JSON.parse(sessionStorage.getItem("configGoon")).show_seek_bar){let o=document.createElement("div");o.style.position="absolute",o.style.bottom="0",o.style.left="0",o.style.width="100%",o.style.height="7px",e.appendChild(o);let i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style.backgroundColor="none",o.appendChild(i);let l=document.createElement("div");l.style.width="0",l.style.height="100%",l.style.backgroundColor="#66140C",i.appendChild(l),t.addEventListener("timeupdate",()=>{let e=t.currentTime/t.duration*100;l.style.width=`${e}%`,(vid=JSON.parse(sessionStorage.getItem("vid"))).forEach(e=>{e.src===t.src&&(e.timestamp=t.currentTime)}),sessionStorage.setItem("vid",JSON.stringify(vid))}),e.appendChild(o)}t.addEventListener("timeupdate",()=>{(vid=JSON.parse(sessionStorage.getItem("vid"))).forEach(e=>{e.src===t.src&&(e.timestamp=t.currentTime)}),sessionStorage.setItem("vid",JSON.stringify(vid))});let n=document.createElement("div");n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.cursor="move",n.addEventListener("mousedown",s=>{let r=s.clientX,o=s.clientY,i=e.getBoundingClientRect(),l=r-i.left,n=o-i.top,d=s=>{let r=s.clientX-l,o=s.clientY-n;e.style.top=`${o}px`,e.style.left=`${r}px`,(vid=JSON.parse(sessionStorage.getItem("vid"))).forEach(e=>{e.src===t.src&&(e.top=o,e.left=r)}),sessionStorage.setItem("vid",JSON.stringify(vid))};document.addEventListener("mousemove",d);let a=()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",a)};document.addEventListener("mouseup",a)}),e.appendChild(n),e.addEventListener("mouseover",()=>{s.style.display="block",r.style.display="block"}),e.addEventListener("mouseout",()=>{s.style.display="none",r.style.display="none"}),(videos=document.querySelectorAll(".video-container-fullscreen")).forEach(e=>{e.addEventListener("click",()=>{zIndexes=[],vid=JSON.parse(sessionStorage.getItem("vid")),videos.forEach(e=>{zIndexes.push(parseInt(e.style.zIndex))}),maxZIndex=Math.max(...zIndexes),e.style.zIndex=maxZIndex+1,vid.forEach(e=>{e.src===t.src&&(e.zIndex=maxZIndex+1)}),sessionStorage.setItem("vid",JSON.stringify(vid)),videoSrc=e.querySelector("video");let r=!1;document.addEventListener("keydown",e=>{!r&&(skipSeconds=parseInt(JSON.parse(sessionStorage.getItem("configGoon")).skip_seconds),"ArrowRight"!==e.key||e.shiftKey?"ArrowLeft"!==e.key||e.shiftKey||setTimeout(()=>{e.preventDefault(),videoSrc.currentTime-=skipSeconds},500):(e.preventDefault(),setTimeout(()=>{videoSrc.currentTime+=skipSeconds,r=!0},500)),r=!0,setTimeout(()=>{r=!1},1e3))}),document.addEventListener("keydown",r=>{" "!==r.key&&"Spacebar"!==r.key||r.shiftKey?"ArrowRight"!==r.key||r.shiftKey?"ArrowLeft"!==r.key||r.shiftKey?"ArrowUp"!==r.key||r.shiftKey?"ArrowDown"===r.key&&!r.shiftKey&&(r.preventDefault(),videoSrc.volume>0&&(e.muted=!1,videoSrc.volume-=.1,(vids=JSON.parse(sessionStorage.getItem("vid"))).forEach(s=>{s.src===t.src&&(e.muted=!1,s.volume=videoSrc.volume)}),sessionStorage.setItem("vid",JSON.stringify(vids)))):(r.preventDefault(),videoSrc.volume<1&&(e.muted=!1,videoSrc.volume+=.1,(vids=JSON.parse(sessionStorage.getItem("vid"))).forEach(e=>{e.src===t.src&&(e.volume=videoSrc.volume)}),sessionStorage.setItem("vid",JSON.stringify(vids)))):(skipSeconds=parseInt(JSON.parse(sessionStorage.getItem("configGoon")).skip_seconds),setTimeout(()=>{r.preventDefault(),videoSrc.currentTime-=skipSeconds},500)):(skipSeconds=parseInt(JSON.parse(sessionStorage.getItem("configGoon")).skip_seconds),setTimeout(()=>{r.preventDefault(),videoSrc.currentTime+=skipSeconds},500)):(r.preventDefault(),videoSrc.paused?(videoSrc.play(),s.innerHTML="⏸",(vid=JSON.parse(sessionStorage.getItem("vid"))).forEach(e=>{e.src===t.src&&(e.paused=!1)}),sessionStorage.setItem("vid",JSON.stringify(vid))):(videoSrc.pause(),s.innerHTML="▶",(vid=JSON.parse(sessionStorage.getItem("vid"))).forEach(e=>{e.src===t.src&&(e.paused=!0)}),sessionStorage.setItem("vid",JSON.stringify(vid))))})})});let d=document.querySelectorAll(".video-container-fullscreen");d.forEach(e=>{let s=!1,r,o,i=document.createElement("div");i.style.zIndex="99999999999999999999",i.style.position="absolute",i.style.bottom="0",i.style.right="0",i.style.width="50px",i.style.height="50px",i.style.background="none",i.style.cursor="se-resize",i.className="resize-handle",e.appendChild(i),i.addEventListener("mousedown",e=>{e.preventDefault(),s=!0,r=e.clientX,o=e.clientY}),document.addEventListener("mousemove",i=>{if(!s)return;let l=i.clientX-r,n=i.clientY-o,d=e.offsetWidth+l,a=e.offsetHeight+n;e.style.width=`${d}px`,e.style.height="auto",r=i.clientX,o=i.clientY,(vid=JSON.parse(sessionStorage.getItem("vid"))).forEach(e=>{e.src===t.src&&(e.width=d,e.height=a)}),sessionStorage.setItem("vid",JSON.stringify(vid))}),document.addEventListener("mouseup",()=>{s=!1})}),t.addEventListener("ended",()=>{if(sessionStorage.getItem("configGoon")&&JSON.parse(sessionStorage.getItem("configGoon")).remove_when_ended){document.body.removeChild(e),vid=JSON.parse(sessionStorage.getItem("vid"));let s=vid.findIndex(e=>e.src===t.src);vid.splice(s,1),sessionStorage.setItem("vid",JSON.stringify(vid))}})}function s(e){e.forEach(e=>{if(allSrc.includes(e.src))return;allSrc.push(e.src);let s=document.createElement("div");s.classList.add("video-container-fullscreen"),s.style.position="fixed",s.style.top=e.top+"px",s.style.left=e.left+"px",s.style.width=e.width+"px",s.style.height="fit-content",s.style.zIndex=e.zIndex,document.body.appendChild(s);let r=document.createElement("video");r.src=e.src,e.pause||(r.autoplay=!0),r.style.width="100%",r.style.height="auto",r.currentTime=e.timestamp,r.volume=e.volume,s.appendChild(r),t(s,r)})}function r(e){(vid=JSON.parse(sessionStorage.getItem("vid"))).forEach(t=>{if(t.src===e[0])return}),done=!0,sessionStorage.setItem("paused","false"),sessionStorage.setItem("muted","false"),(vid=JSON.parse(sessionStorage.getItem("vid"))).push({src:e[0],width:200,height:0,timestamp:0,zIndex:2e9,paused:!1,top:0,left:0,volume:1}),sessionStorage.setItem("vid",JSON.stringify(vid));let s=document.createElement("div");s.classList.add("video-container-fullscreen"),s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="200px",s.style.height="fit-content",s.style.zIndex="2000000000",document.body.appendChild(s);let r=document.createElement("video");r.src=e[0],sessionStorage.getItem("configGoon")&&JSON.parse(sessionStorage.getItem("configGoon")).autoplay&&(r.autoplay=!0),r.style.width="100%",r.style.height="auto",s.appendChild(r),t(s,r)}async function o(){await new Promise(e=>{setTimeout(()=>{e()},1e3)}),logs=[],(videos=document.querySelectorAll("video")).forEach(e=>{logs.push(e.src)}),r(logs)}chrome.storage.sync.get("configGoon",t=>{let s=t.configGoon||e;sessionStorage.setItem("configGoon",JSON.stringify(s))}),allSrc=[],null!==JSON.parse(sessionStorage.getItem("vid"))&&""!==sessionStorage.getItem("vid")&&"undefined"!==sessionStorage.getItem("vid")?s(JSON.parse(sessionStorage.getItem("vid"))):sessionStorage.setItem("vid",JSON.stringify([])),s(JSON.parse(sessionStorage.getItem("vid"))),document.body.style.userSelect="none";try{document.querySelector("#player_wrapper_outer > div.play_cover > span.i-play").click()}catch(i){console.log(i)}let l=document.querySelectorAll(".video_toolbar");l.forEach(e=>{var t=document.createElement("button");t.style.backgroundColor="grey",t.style.padding="5px",t.style.zIndex="2147483647",t.style.position="absolute",t.style.right="50%",t.style.fontSize="15px",t.style.color="white",t.style.fontWeight="bolder",t.style.borderRadius="5px",t.style.cursor="pointer",t.style.bottom="55px",t.textContent="+",t.addEventListener("click",o),e.appendChild(t)}),document.querySelectorAll(".video-item").forEach(e=>{(plus=document.createElement("button")).style.backgroundColor="grey",plus.style.padding="5px",plus.style.zIndex="999",plus.style.position="absolute",plus.style.right="50%",plus.style.fontSize="15px",plus.style.color="white",plus.style.fontWeight="bolder",plus.style.borderRadius="5px",plus.style.cursor="pointer",plus.style.bottom="55px",plus.innerHTML="+",e.appendChild(plus),plus.addEventListener("click",()=>{(xhr=new XMLHttpRequest).open("GET",e.querySelector("a").href),xhr.onload=function(){if(200===xhr.status){let e=xhr.responseText,t=new DOMParser,s=t.parseFromString(e,"text/html"),o=s.querySelector("video");r([src=o.querySelector("source").src])}else console.error("Request failed. Status code: "+xhr.status)},xhr.send()})});try{(recs=document.querySelector("#video > div.right > div > div")).querySelectorAll("div").forEach(e=>{(plus=document.createElement("button")).style.backgroundColor="grey",plus.style.padding="5px",plus.style.zIndex="999",plus.style.position="absolute",plus.style.right="50%",plus.style.fontSize="15px",plus.style.color="white",plus.style.fontWeight="bolder",plus.style.borderRadius="5px",plus.style.cursor="pointer",plus.style.bottom="55px",plus.textContent="+",e.appendChild(plus),plus.addEventListener("click",()=>{(xhr=new XMLHttpRequest).open("GET",e.querySelector("a").href),xhr.onload=function(){if(200===xhr.status){let e=xhr.responseText,t=new DOMParser,s=t.parseFromString(e,"text/html"),o=s.querySelector("video");src=o.querySelector("source").src,r([src])}else console.error("Request failed. Status code: "+xhr.status)},xhr.send()})})}catch(n){console.log(n)}},document.addEventListener("keydown",e=>{"p"===e.key&&(paused=sessionStorage.getItem("paused"),(vids=document.querySelectorAll("video")).forEach(e=>{"true"===paused?e.pause():e.play()}),"true"===paused?sessionStorage.setItem("paused","false"):sessionStorage.setItem("paused","true"))}),document.addEventListener("keydown",e=>{"c"===e.key&&(vids=document.querySelectorAll(".video-container-fullscreen")).forEach(e=>{(btns=e.querySelectorAll("button")).forEach(e=>{e.click()})})}),document.addEventListener("keydown",e=>{let t=JSON.parse(sessionStorage.getItem("configGoon")).quick_switch_links;if("q"===e.key){(videos=document.querySelectorAll("video")).forEach(e=>{e.pause()});let s=document.querySelector('link[rel="icon"]');s.href="https://www.iconpacks.net/icons/2/free-youtube-logo-icon-2431-thumb.png",window.open(t,"_blank")}}),document.addEventListener("keydown",e=>{"m"===e.key&&(muted=sessionStorage.getItem("muted"),(vids=document.querySelectorAll("video")).forEach(e=>{"true"===muted?e.muted=!1:e.muted=!0}),"true"===muted?sessionStorage.setItem("muted","false"):sessionStorage.setItem("muted","true"))});